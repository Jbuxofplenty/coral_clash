# Cursor AI Rules for Coral Clash

## Git Commit Guidelines

- ALWAYS use conventional commit format: `<type>(<scope>): <subject>`
- Valid types: feat, fix, docs, refactor, test, ci, chore, build, perf, style
- Examples:
    - `feat(ci): add test gate before staging deployment`
    - `fix(ios): add encryption exemption to Info.plist`
    - `docs(deployment): add approval setup guide`
    - `refactor(workflows): simplify platform selection logic`

## Git Operations

- NEVER run `git commit/push` unless explicitly requested by the user
- Ask for confirmation before force pushing or destructive git operations

## Firebase Development

- NEVER restart Firebase emulators unless explicitly requested
- NEVER stop running Firebase emulators automatically
- Keep emulators running in the background
- Always add tests to functions (i.e. routes, triggers, scheduled funcs)

## Development Workflow

- Run tests before suggesting deployment
- Use iOS as default platform (until Android setup is complete)
- Prefer `yarn` over `npm` for package management

## Code Quality

- Follow existing code style and patterns in the repository
- Use TypeScript types when working with shared module
- Keep functions focused and single-purpose
- Always add tests for BE related code (not react components atm)

## Testing

- **ALWAYS** load a fixture or use INITIAL_STATE when writing tests for game logic
- Never test with an empty board state unless explicitly testing initialization
- Use `applyFixture(game, fixture)` for complex game states
- Use `game.load(fen)` for simple board setups
- Create fixtures in `shared/game/__fixtures__/` for reusable test scenarios
- All tests must pass before committing - remove or fix failing tests

## Documentation

- Update relevant documentation when making significant changes
- Include examples in documentation
- Keep docs concise and actionable

## Build & Deployment

- Use Fastlane for building and submitting apps (iOS & Android)
- Use `npx expo prebuild` to generate native directories
- Never commit generated `ios/` or `android/` directories
- Version bumping is handled by CI/CD workflows
- iOS builds require Fastlane Match for code signing
- Android builds require keystore (never commit `.keystore` files)

## Communication

- Be concise but thorough in explanations
- Show what changed and why it matters
- Provide examples when introducing new patterns
- Add documentation markdown file to docs folder for complex features/architecture
